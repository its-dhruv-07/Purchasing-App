<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Purchasing List</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f9f9f9; }
    .card { border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    table input { width: 100px; }
    h2 { text-align: center; margin: 20px 0; }
  </style>
</head>
<body>
<div class="container my-4">
  <h2>ðŸ›’ Purchasing List</h2>

  <!-- Step 1: Add Items -->
  <div class="card p-4 mb-4">
    <h4>Add Item</h4>
    <div class="row g-3">
      <div class="col-md-3"><input id="itemName" type="text" class="form-control" placeholder="Item name"></div>
      <div class="col-md-3"><input id="quantity" type="text" class="form-control" placeholder="Quantity (e.g. 2kg)"></div>
      <div class="col-md-3"><input id="forWhom" type="text" class="form-control" placeholder="For whom"></div>
      <div class="col-md-3"><button class="btn btn-success w-100" onclick="addItem()">Add</button></div>
    </div>
  </div>

  <!-- Step 2: Items List -->
  <div class="card p-4">
    <h4>Items List</h4>
    <div class="table-responsive">
      <table class="table table-bordered mt-3 align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>Purchased</th>
            <th>Item</th>
            <th>Quantity</th>
            <th>For Whom</th>
            <th>Cost per Unit</th>
            <th>No. of Units</th>
            <th>Total Cost</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="itemsTable"></tbody>
      </table>
    </div>

    <!-- Totals -->
    <div class="d-flex justify-content-between mt-3">
      <h5>Grand Total: <span class="badge bg-primary" id="grandTotal">0</span></h5>
      <h5>Purchased Total: <span class="badge bg-success" id="purchasedTotal">0</span></h5>
    </div>

    <!-- Print Buttons -->
    <div class="mt-3">
      <button class="btn btn-primary me-2" onclick="printItems(false)">Print All Items</button>
      <button class="btn btn-info" onclick="printItems(true)">Print Purchased Only</button>
    </div>
  </div>
</div>

<script>
let items = [];
let editingIndex = -1;

function addItem() {
  let name = document.getElementById("itemName").value.trim();
  let qty = document.getElementById("quantity").value.trim();
  let forWhom = document.getElementById("forWhom").value.trim();

  if (!name || !qty || !forWhom) return alert("Please fill all fields!");

  if (editingIndex === -1) {
    items.push({ name, qty, forWhom, cost: "", units: "", total: 0, purchased: false });
  } else {
    items[editingIndex].name = name;
    items[editingIndex].qty = qty;
    items[editingIndex].forWhom = forWhom;
    editingIndex = -1;
  }

  document.getElementById("itemName").value = "";
  document.getElementById("quantity").value = "";
  document.getElementById("forWhom").value = "";
  renderTable();
}

function editItem(i) {
  document.getElementById("itemName").value = items[i].name;
  document.getElementById("quantity").value = items[i].qty;
  document.getElementById("forWhom").value = items[i].forWhom;
  editingIndex = i;
}

function deleteItem(i) {
  items.splice(i, 1);
  renderTable();
}

function updateField(i, field, value) {
  items[i][field] = value;

  let cost = parseFloat(items[i].cost) || 0;
  let unitsNumber = parseFloat(items[i].units) || 0; // numeric part only
  items[i].total = (cost * unitsNumber).toFixed(2);

  renderTable();
}

function togglePurchased(i) {
  items[i].purchased = !items[i].purchased;
  renderTable();
}

function calculateTotals() {
  let grand = 0, purchased = 0;
  items.forEach(it => {
    grand += parseFloat(it.total) || 0;
    if (it.purchased) purchased += parseFloat(it.total) || 0;
  });
  document.getElementById("grandTotal").innerText = grand.toFixed(2);
  document.getElementById("purchasedTotal").innerText = purchased.toFixed(2);
}

function renderTable() {
  let tbody = document.getElementById("itemsTable");
  tbody.innerHTML = "";

  items.forEach((item, i) => {
    let row = `
      <tr>
        <td><input type="checkbox" ${item.purchased ? "checked" : ""} onclick="togglePurchased(${i})"></td>
        <td>${item.name}</td>
        <td>${item.qty}</td>
        <td>${item.forWhom}</td>
        <td><input type="text" class="form-control" value="${item.cost}" oninput="updateField(${i}, 'cost', this.value)"></td>
        <td><input type="text" class="form-control" value="${item.units}" oninput="updateField(${i}, 'units', this.value)"></td>
        <td>${item.total}</td>
        <td>
          <button class="btn btn-sm btn-warning" onclick="editItem(${i})">Edit</button>
          <button class="btn btn-sm btn-danger" onclick="deleteItem(${i})">Delete</button>
        </td>
      </tr>`;
    tbody.innerHTML += row;
  });

  calculateTotals();
}

function printItems(purchasedOnly) {
  let now = new Date().toLocaleString();
  let html = `<h2>Purchasing List</h2><p>${now}</p><table border="1" cellspacing="0" cellpadding="8"><tr>
    <th>Item</th><th>Quantity</th><th>For Whom</th><th>Cost/Unit</th><th>Units</th><th>Total</th></tr>`;
  
  let total = 0;
  items.forEach(it => {
    if (!purchasedOnly || it.purchased) {
      html += `<tr>
        <td>${it.name}</td>
        <td>${it.qty}</td>
        <td>${it.forWhom}</td>
        <td>${it.cost}</td>
        <td>${it.units}</td>
        <td>${it.total}</td>
      </tr>`;
      total += parseFloat(it.total) || 0;
    }
  });
  html += `</table><h3>Total = ${total.toFixed(2)}</h3>`;

  let printWindow = window.open("", "_blank");
  printWindow.document.write(html);
  printWindow.document.close();
  printWindow.print();
}

renderTable();
</script>
</body>
</html>
